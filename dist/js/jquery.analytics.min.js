!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(e,t){s=t.analyticsHost||s,o=t.httpVersion||o,a=t.fallbackIp||a,p=t.debug||p,this.serviceToken=e,this.fetchClientIp="undefined"==typeof t.fetchClientIp?!0:t.fetchClientIp,this.init()}var n="Analytics",r="1.0.0",i="jQuery Analytics Agent",s="http://socket.apianalytics.com/",a="127.0.0.1",o="HTTP/1.1",p=!1,u=e(document),c=a;return t.getClientIp=function(){return c},e.extend(t.prototype,{init:function(){this.fetchClientIp&&e.ajax({url:"http://httpbin.org/ip",type:"GET",global:!1,success:function(e){c=e.origin}}),u.ajaxSend(this.onSend.bind(this)),u.ajaxComplete(this.onComplete.bind(this))},onSend:function(e,t,n){n._startTime=+new Date,n._sendTime=n._startTime-e.timeStamp},onComplete:function(n,s,u){var c=new t.Alf(this.serviceToken,{name:i,version:r});u.type=u.type.toUpperCase();var l,d,f,h=u._startTime,y=n.timeStamp,g=y-h,m=u.url,S=t.getResponseHeaderObject(s),T=u.headers,v="GET"===u.type?u.data:{};try{f="GET"===u.type?"string"==typeof u.data?u.data:JSON.stringify(u.data):""}catch(b){f=""}d=t.getStringByteSize(f||""),l=t.getStringByteSize(s.responseText||""),"string"==typeof v&&(v=t.parseQueryString(v)),-1!==m.indexOf("?")&&e.extend(v,t.parseQueryString(m)),v=t.marshalObjectToArray(v),T=t.marshalObjectToArray(T),S=t.marshalObjectToArray(S),c.entry({startedDateTime:new Date(h).toISOString(),serverIpAddress:a,clientIpAddress:t.getClientIp(),time:g,request:{method:u.type,url:u.url,httpVersion:o,queryString:v,headers:T,headersSize:-1,bodySize:d},response:{status:s.status,statusText:s.statusText,httpVersion:o,headers:S,headersSize:-1,bodySize:l},timings:{blocked:0,dns:0,connect:0,send:u._sendTime,wait:g,receive:0,ssl:0}}),p?(u._alf=c,c.send(u)):c.send()}}),t.Alf=function(e,t){this.output={serviceToken:e,har:{log:{version:"1.2",creator:t,entries:[]}}}},t.Alf.prototype.entry=function(e){this.output.har.log.entries.push(e)},t.Alf.prototype.send=function(t){var n={url:s,global:!1,type:"POST",data:JSON.stringify(this.output),dataType:"json",contentType:"application/json"};p||e.ajax(n),t&&(t._alfRequest=n)},t.getResponseHeaderObject=function(e){var t,n=e.getAllResponseHeaders(),r={};if(!n)return r;t=n.split("\r\n");for(var i=0,s=t.length;s>i;i++){var a=t[i],o=a.indexOf(": ");if(o>0){var p=a.substring(0,o),u=a.substring(o+2);r[p]=u}}return r},t.parseQueryString=function(e){if(!e)return{};e=decodeURIComponent(e);var t,n=e.indexOf("?"),r={};if(e=-1!==n?e.slice(0,n):e,e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return r;for(var i=0,s=t.length;s>i;i++){var a=t[i].split("="),o=a[0],p=a[1];o.length?r[o]&&(r[o].push||(r[o]=[r[o]]),r[o].push(p||"")):r[o]=p||""}return r},t.marshalObjectToArray=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({name:n,value:e[n]});return t},t.getStringByteSize=function(e){return encodeURI(e).split(/%(?:u[0-9A-F]{2})?[0-9A-F]{2}|./).length-1},e[n]=function(e,n){if("object"==typeof e&&(n=e,e=n.serviceToken),n=n||{},"string"!=typeof e||0===e.length)throw{name:"MissingArgument",message:"Service token is missing"};return new t(e,n)},t});