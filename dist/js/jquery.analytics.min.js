!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(e,t){s=t.analyticsHost||s,a=t.httpVersion||a,o=t.fallbackIp||o,h=t.serverIp||o,l=t.clientIp||o,c=t.ssl?"https://":c,f=t.debug||f,this.serviceToken=e,this.hostname=t.hostname||(window&&window.location?window.location.hostname:!1),this.fetchClientIp="undefined"==typeof t.fetchClientIp?!0:t.fetchClientIp,this.fetchServerIp="undefined"==typeof t.fetchServerIp?!0:t.fetchServerIp,this.init()}var n="Analytics",r="1.3.1",i="mashape-analytics-agent-jquery",s="socket.analytics.mashape.com/",o="127.0.0.1",a="HTTP/1.1",p="",c="http://",u="1.0.0",l=o,h=o,f=!1,d=!1,g="SKIjLjUcjBmshb733ZqAGiNYu6Qvp1Ue0XGjsnYZRXaI8y1U4O",y=e(document),m=[];return e.extend(t.prototype,{init:function(){var e=this;this.getClientIp(function(){e.getServerIp(function(){e.onReady()})}),y.ajaxSend(this.onSend.bind(this)),y.ajaxComplete(this.onComplete.bind(this))},getServerIp:function(t){var n=c+"statdns.p.mashape.com/"+this.hostname+"/a?mashape-key="+g;return this.fetchServerIp&&"string"==typeof this.hostname&&0!==this.hostname.length?e.ajax({url:n,type:"GET",global:!1,success:function(e){h=e.answer[0].rdata},complete:function(){t()}}):t()},getClientIp:function(t){return this.fetchClientIp?e.ajax({url:c+"httpbin.org/ip",type:"GET",global:!1,success:function(e){l=e.origin},complete:function(){t()}}):void t()},onReady:function(){if(m){var e;d=!0;for(var t=0,n=m.length;n>t;t++)e=m[t],e.alf.output.har.log.entries[0].serverIpAddress=this.serverIp,e.alf.output.har.log.entries[0].clientIpAddress=this.clientIp,e.alf.send(e.options);m=null}},onSend:function(e,t,n){n._startTime=+new Date,n._sendTime=n._startTime-e.timeStamp},onComplete:function(n,s,o){var p=new t.Alf(this.serviceToken,{name:i,version:r});o.type=o.type.toUpperCase();var c,u,l,g=o._startTime,y=n.timeStamp,v=y-g,S=o.url,T=t.getResponseHeaderObject(s),j=o.headers,b="GET"===o.type?o.data:{};try{l="GET"===o.type?"string"==typeof o.data?o.data:JSON.stringify(o.data):""}catch(I){l=""}u=t.getStringByteSize(l||""),c=t.getStringByteSize(s.responseText||""),"string"==typeof b&&(b=t.parseQueryString(b)),-1!==S.indexOf("?")&&e.extend(b,t.parseQueryString(S)),p.entry({startedDateTime:new Date(g).toISOString(),serverIpAddress:h,time:v,request:{method:o.type,url:o.url,httpVersion:a,queryString:t.marshalObjectToArray(b),headers:t.marshalObjectToArray(j),cookies:[],headersSize:-1,bodySize:u},response:{status:s.status,statusText:s.statusText,httpVersion:a,headers:t.marshalObjectToArray(T),cookies:[],headersSize:-1,bodySize:c,redirectURL:t.getObjectValue(T,"Location")||"",content:{mimeType:t.getObjectValue(T,"Content-Type")||"application/octet-stream",size:c}},timings:{blocked:0,dns:0,connect:0,send:o._sendTime,wait:v,receive:0,ssl:0},cache:{}}),f&&(o._alf=p),d?p.send(f?o:void 0):m.push({options:f?o:void 0,alf:p})}}),t.Alf=function(e,t){this.output={version:u,environment:p,serviceToken:e,clientIpAddress:l,har:{log:{version:"1.2",creator:t,entries:[]}}}},t.Alf.prototype.entry=function(e){this.output.har.log.entries.push(e)},t.Alf.prototype.send=function(t){var n={url:c+s+u+"/single",global:!1,type:"POST",data:JSON.stringify(this.output),dataType:"json",contentType:"application/json"};f||e.ajax(n),t&&(t._alfRequest=n)},t.getResponseHeaderObject=function(e){var t,n=e.getAllResponseHeaders(),r={};if(!n)return r;t=n.split("\r\n");for(var i=0,s=t.length;s>i;i++){var o=t[i],a=o.indexOf(": ");if(a>0){var p=o.substring(0,a),c=o.substring(a+2);r[p]=c}}return r},t.parseQueryString=function(e){if(!e)return{};e=decodeURIComponent(e);var t,n=e.indexOf("?"),r={};if(e=-1!==n?e.slice(0,n):e,e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return r;t=e.split("&");for(var i=0,s=t.length;s>i;i++){var o=t[i].split("="),a=o[0],p=o[1];a.length?r[a]&&(r[a].push||(r[a]=[r[a]]),r[a].push(p||"")):r[a]=p||""}return r},t.marshalObjectToArray=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({name:n,value:e[n]});return t},t.getObjectValue=function(e,t){return Object.keys(e).length?e[t]:null},t.getStringByteSize=function(e){return encodeURI(e).split(/%(?:u[0-9A-F]{2})?[0-9A-F]{2}|./).length-1},e[n]=function(e,n){if("object"==typeof e&&(n=e,e=n.serviceToken),n=n||{},"string"!=typeof e||0===e.length)throw{name:"MissingArgument",message:"Service token is missing"};return new t(e,n)},t});