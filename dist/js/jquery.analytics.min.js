!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(e,t){s=t.analyticsHost||s,a=t.httpVersion||a,o=t.fallbackIp||o,p=t.ssl?"https://":"http://",c=t.debug||c,this.serviceToken=e,this.clientIp=t.clientIp||o,this.serverIp=t.serverIp||o,this.hostname=t.hostname||(window&&window.location?window.location.hostname:!1),this.fetchClientIp="undefined"==typeof t.fetchClientIp?!0:t.fetchClientIp,this.fetchServerIp="undefined"==typeof t.fetchServerIp?!0:t.fetchServerIp,this.init()}var n="Analytics",r="1.2.0",i="jQuery Analytics Agent",s="socket.apianalytics.com/",o="127.0.0.1",a="HTTP/1.1",p="http://",u="SKIjLjUcjBmshb733ZqAGiNYu6Qvp1Ue0XGjsnYZRXaI8y1U4O",c=!1,h=!1,l=e(document),f=[];return e.extend(t.prototype,{init:function(){var e=this;this.getClientIp(function(){e.getServerIp(function(){e.onReady()})}),l.ajaxSend(this.onSend.bind(this)),l.ajaxComplete(this.onComplete.bind(this))},getServerIp:function(t){var n=p+"statdns.p.mashape.com/"+this.hostname+"/a?mashape-key="+u,r=this;return this.fetchServerIp&&"string"==typeof this.hostname&&0!==this.hostname.length?e.ajax({url:n,type:"GET",global:!1,success:function(e){r.serverIp=e.answer[0].rdata},complete:function(){t()}}):t()},getClientIp:function(t){var n=this;return this.fetchClientIp?e.ajax({url:p+"httpbin.org/ip",type:"GET",global:!1,success:function(e){n.clientIp=e.origin},complete:function(){t()}}):void t()},onReady:function(){if(f){var e;h=!0;for(var t=0,n=f.length;n>t;t++)e=f[t],e.alf.output.har.log.entries[0].serverIpAddress=this.serverIp,e.alf.output.har.log.entries[0].clientIpAddress=this.clientIp,e.alf.send(e.options);f=null}},onSend:function(e,t,n){n._startTime=+new Date,n._sendTime=n._startTime-e.timeStamp},onComplete:function(n,s,o){var p=this,u=new t.Alf(this.serviceToken,{name:i,version:r});o.type=o.type.toUpperCase();var l,d,y,g=o._startTime,v=n.timeStamp,m=v-g,I=o.url,S=t.getResponseHeaderObject(s),T=o.headers,j="GET"===o.type?o.data:{};try{y="GET"===o.type?"string"==typeof o.data?o.data:JSON.stringify(o.data):""}catch(b){y=""}d=t.getStringByteSize(y||""),l=t.getStringByteSize(s.responseText||""),"string"==typeof j&&(j=t.parseQueryString(j)),-1!==I.indexOf("?")&&e.extend(j,t.parseQueryString(I)),j=t.marshalObjectToArray(j),T=t.marshalObjectToArray(T),S=t.marshalObjectToArray(S),u.entry({startedDateTime:new Date(g).toISOString(),serverIpAddress:p.serverIp,clientIpAddress:p.clientIp,time:m,request:{method:o.type,url:o.url,httpVersion:a,queryString:j,headers:T,headersSize:-1,bodySize:d},response:{status:s.status,statusText:s.statusText,httpVersion:a,headers:S,headersSize:-1,bodySize:l},timings:{blocked:0,dns:0,connect:0,send:o._sendTime,wait:m,receive:0,ssl:0}}),c&&(o._alf=u),h?u.send(c?o:void 0):f.push({options:c?o:void 0,alf:u})}}),t.Alf=function(e,t){this.output={serviceToken:e,har:{log:{version:"1.2",creator:t,entries:[]}}}},t.Alf.prototype.entry=function(e){this.output.har.log.entries.push(e)},t.Alf.prototype.send=function(t){var n={url:p+s,global:!1,type:"POST",data:JSON.stringify(this.output),dataType:"json",contentType:"application/json"};c||e.ajax(n),t&&(t._alfRequest=n)},t.getResponseHeaderObject=function(e){var t,n=e.getAllResponseHeaders(),r={};if(!n)return r;t=n.split("\r\n");for(var i=0,s=t.length;s>i;i++){var o=t[i],a=o.indexOf(": ");if(a>0){var p=o.substring(0,a),u=o.substring(a+2);r[p]=u}}return r},t.parseQueryString=function(e){if(!e)return{};e=decodeURIComponent(e);var t,n=e.indexOf("?"),r={};if(e=-1!==n?e.slice(0,n):e,e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return r;t=e.split("&");for(var i=0,s=t.length;s>i;i++){var o=t[i].split("="),a=o[0],p=o[1];a.length?r[a]&&(r[a].push||(r[a]=[r[a]]),r[a].push(p||"")):r[a]=p||""}return r},t.marshalObjectToArray=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({name:n,value:e[n]});return t},t.getStringByteSize=function(e){return encodeURI(e).split(/%(?:u[0-9A-F]{2})?[0-9A-F]{2}|./).length-1},e[n]=function(e,n){if("object"==typeof e&&(n=e,e=n.serviceToken),n=n||{},"string"!=typeof e||0===e.length)throw{name:"MissingArgument",message:"Service token is missing"};return new t(e,n)},t});